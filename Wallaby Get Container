#include <kipr/botball.h>

/*
port 0 = right motor
port 1 = left motor
*/
#define miniservo_up 644
#define miniservo_down 1713
#define miniservo_collect 877
#define claw_down 1529
#define claw_up 42
#define claw_open 1000
#define claw_close 200
int gyrocalibrate() {
    int changeGyroZ = 0;//find average gyro value when still
    int i = 0;
    for(i = 0; i < 10000; i++) {
        changeGyroZ += gyro_z();
    }
    changeGyroZ /= 10000;
    
   	return changeGyroZ;
}
void move(int speed, int time, int changeGyroZ) {//speed -100 to 100, time is in miliseconds
    int i = 0;
    int anglechange = 0;
    for(i = 0; i < time; i++) {//gyro move
        anglechange += gyro_z()-changeGyroZ;
        motor(0, speed-anglechange/200);
        motor(1, speed+anglechange/200);
        msleep(1);
    }
    ao();
}
void turn(int direction, int degree, int changeGyroZ) {
    int i = 0;
    int anglechange = 0;
    int x = degree*111000/90;
    if(direction == 1) { // 1 = clockwise, 0 = counter-clockwise
    	while(anglechange > -x) {
        	anglechange += gyro_z()-changeGyroZ;
        	motor(0, -100);
        	motor(1, 100);
        	msleep(1);
    	}
    } else {
        while(anglechange < x) {
        	anglechange += gyro_z()-changeGyroZ;
        	motor(0, 100);
        	motor(1, -100);
        	msleep(1);
    	}
    }
    ao();
}
int main()
{
    //start centered on pipe connectors
    int change = gyrocalibrate();
    enable_servos();
  

    set_servo_position(2, 644);
    msleep(500);
        
    set_servo_position(1, 1000);
    msleep(500);
        
    move(100, 400, change); //drive out of base
    msleep(500);
    
    turn(1, 90, change); //90 clockwise
    msleep(1000);
    
    move(-100,350, change);//move back to align
    msleep(500);
 
   	turn(0, 90, change); //90 counterclockwise
    msleep(1000);

    move(-100, 600, change); //drive back to ram into barrel
    msleep(500);
 */

    disable_servos();
    return 0;
    
}
